
#include "p33fxxxx.h"
#include "dsp.h"
//#include "..\h\adcdacDrv.h"

// Sampling Control
#define Fosc		79227500
#define Fcy			(Fosc/2)
#define Fs   		103160 //8038 //44211 //25000 // //Hz
#define SAMPPRD    (Fcy/Fs)-1
#define NUMSAMP     128

#define MIDI_BUF_SIZE 32

typedef unsigned char bool;
#define false 0
#define true 1

// Functions
void initDac(void);
void initDma0(void);
void __attribute__((interrupt, no_auto_psv)) _DMA0Interrupt(void);
void __attribute__((interrupt, no_auto_psv)) _DAC1RInterrupt(void);

fractional DacBufferA[NUMSAMP] __attribute__((space(dma)));	// Ping-pong buffer A
fractional DacBufferB[NUMSAMP] __attribute__((space(dma)));	// Ping-pong buffer B
fractional DciBufferA[NUMSAMP] __attribute__((space(dma)));	// Ping-pong buffer A
fractional DciBufferB[NUMSAMP] __attribute__((space(dma)));	// Ping-pong buffer B
unsigned char MidiBufferA[MIDI_BUF_SIZE] __attribute__((space(dma)));	// Ping-pong buffer A
unsigned char MidiBufferB[MIDI_BUF_SIZE] __attribute__((space(dma)));	// Ping-pong buffer B

unsigned char msg[3];

unsigned int didx = 0;
unsigned char d[2241] = {0x00, 0x90, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x39,
0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x41, 0x64, 0x81, 0x20,
0x41, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50,
0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x41, 0x64, 0x81,
0x20, 0x41, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00,
0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x41, 0x64,
0x81, 0x20, 0x41, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32,
0x00, 0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x41,
0x64, 0x81, 0x20, 0x41, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20,
0x32, 0x00, 0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50,
0x41, 0x64, 0x81, 0x20, 0x41, 0x00, 0x50, 0x39, 0x64, 0x81,
0x20, 0x39, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00,
0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x43, 0x64,
0x81, 0x20, 0x43, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32,
0x00, 0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x43,
0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20,
0x32, 0x00, 0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50,
0x43, 0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x32, 0x64, 0x81,
0x20, 0x32, 0x00, 0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00,
0x50, 0x43, 0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x32, 0x64,
0x81, 0x20, 0x32, 0x00, 0x50, 0x39, 0x64, 0x81, 0x20, 0x39,
0x00, 0x50, 0x43, 0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x39,
0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20,
0x32, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00, 0x50,
0x43, 0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x32, 0x64, 0x81,
0x20, 0x32, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00,
0x50, 0x43, 0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x32, 0x64,
0x81, 0x20, 0x32, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A,
0x00, 0x50, 0x43, 0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x32,
0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20,
0x3A, 0x00, 0x50, 0x43, 0x64, 0x81, 0x20, 0x43, 0x00, 0x50,
0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x3A, 0x64, 0x81,
0x20, 0x3A, 0x00, 0x50, 0x43, 0x64, 0x81, 0x20, 0x43, 0x00,
0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00, 0x50, 0x32, 0x64,
0x81, 0x20, 0x32, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A,
0x00, 0x50, 0x43, 0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x32,
0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20,
0x3A, 0x00, 0x50, 0x43, 0x64, 0x81, 0x20, 0x43, 0x00, 0x50,
0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x3A, 0x64, 0x81,
0x20, 0x3A, 0x00, 0x50, 0x40, 0x64, 0x81, 0x20, 0x40, 0x00,
0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x3A, 0x64,
0x81, 0x20, 0x3A, 0x00, 0x50, 0x40, 0x64, 0x81, 0x20, 0x40,
0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x3A,
0x64, 0x81, 0x20, 0x3A, 0x00, 0x50, 0x40, 0x64, 0x81, 0x20,
0x40, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00, 0x50,
0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x39, 0x64, 0x81,
0x20, 0x39, 0x00, 0x50, 0x41, 0x64, 0x81, 0x20, 0x41, 0x00,
0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x39, 0x64,
0x81, 0x20, 0x39, 0x00, 0x50, 0x41, 0x64, 0x81, 0x20, 0x41,
0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x39,
0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x41, 0x64, 0x81, 0x20,
0x41, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50,
0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x41, 0x64, 0x81,
0x20, 0x41, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00,
0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x41, 0x64,
0x81, 0x20, 0x41, 0x00, 0x50, 0x39, 0x64, 0x81, 0x20, 0x39,
0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x39,
0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x43, 0x64, 0x81, 0x20,
0x43, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50,
0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x43, 0x64, 0x81,
0x20, 0x43, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00,
0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x43, 0x64,
0x81, 0x20, 0x43, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32,
0x00, 0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x43,
0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20,
0x32, 0x00, 0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50,
0x43, 0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x39, 0x64, 0x81,
0x20, 0x39, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00,
0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00, 0x50, 0x43, 0x64,
0x81, 0x20, 0x43, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32,
0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00, 0x50, 0x43,
0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20,
0x32, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00, 0x50,
0x43, 0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x32, 0x64, 0x81,
0x20, 0x32, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00,
0x50, 0x43, 0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x32, 0x64,
0x81, 0x20, 0x32, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A,
0x00, 0x50, 0x43, 0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x3A,
0x64, 0x81, 0x20, 0x3A, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20,
0x32, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00, 0x50,
0x43, 0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x32, 0x64, 0x81,
0x20, 0x32, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00,
0x50, 0x43, 0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x32, 0x64,
0x81, 0x20, 0x32, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A,
0x00, 0x50, 0x45, 0x64, 0x81, 0x20, 0x45, 0x00, 0x50, 0x32,
0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x3C, 0x64, 0x81, 0x20,
0x3C, 0x00, 0x50, 0x45, 0x64, 0x81, 0x20, 0x45, 0x00, 0x50,
0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x3C, 0x64, 0x81,
0x20, 0x3C, 0x00, 0x50, 0x45, 0x64, 0x81, 0x20, 0x45, 0x00,
0x50, 0x3C, 0x64, 0x81, 0x20, 0x3C, 0x00, 0x50, 0x2E, 0x64,
0x81, 0x20, 0x2E, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A,
0x00, 0x50, 0x41, 0x64, 0x81, 0x20, 0x41, 0x00, 0x50, 0x2E,
0x64, 0x81, 0x20, 0x2E, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20,
0x3A, 0x00, 0x50, 0x41, 0x64, 0x81, 0x20, 0x41, 0x00, 0x50,
0x2E, 0x64, 0x81, 0x20, 0x2E, 0x00, 0x50, 0x3A, 0x64, 0x81,
0x20, 0x3A, 0x00, 0x50, 0x41, 0x64, 0x81, 0x20, 0x41, 0x00,
0x50, 0x2E, 0x64, 0x81, 0x20, 0x2E, 0x00, 0x50, 0x3A, 0x64,
0x81, 0x20, 0x3A, 0x00, 0x50, 0x41, 0x64, 0x81, 0x20, 0x41,
0x00, 0x50, 0x2E, 0x64, 0x81, 0x20, 0x2E, 0x00, 0x50, 0x3A,
0x64, 0x81, 0x20, 0x3A, 0x00, 0x50, 0x41, 0x64, 0x81, 0x20,
0x41, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00, 0x50,
0x30, 0x64, 0x81, 0x20, 0x30, 0x00, 0x50, 0x37, 0x64, 0x81,
0x20, 0x37, 0x00, 0x50, 0x40, 0x64, 0x81, 0x20, 0x40, 0x00,
0x50, 0x30, 0x64, 0x81, 0x20, 0x30, 0x00, 0x50, 0x37, 0x64,
0x81, 0x20, 0x37, 0x00, 0x50, 0x40, 0x64, 0x81, 0x20, 0x40,
0x00, 0x50, 0x30, 0x64, 0x81, 0x20, 0x30, 0x00, 0x50, 0x37,
0x64, 0x81, 0x20, 0x37, 0x00, 0x50, 0x41, 0x64, 0x81, 0x20,
0x41, 0x00, 0x50, 0x30, 0x64, 0x81, 0x20, 0x30, 0x00, 0x50,
0x37, 0x64, 0x81, 0x20, 0x37, 0x00, 0x50, 0x41, 0x64, 0x81,
0x20, 0x41, 0x00, 0x50, 0x30, 0x64, 0x81, 0x20, 0x30, 0x00,
0x50, 0x37, 0x64, 0x81, 0x20, 0x37, 0x00, 0x50, 0x41, 0x64,
0x81, 0x20, 0x41, 0x00, 0x50, 0x43, 0x64, 0x81, 0x20, 0x43,
0x00, 0x50, 0x2D, 0x64, 0x81, 0x20, 0x2D, 0x00, 0x50, 0x39,
0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x43, 0x64, 0x81, 0x20,
0x43, 0x00, 0x50, 0x2D, 0x64, 0x81, 0x20, 0x2D, 0x00, 0x50,
0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x43, 0x64, 0x81,
0x20, 0x43, 0x00, 0x50, 0x2D, 0x64, 0x81, 0x20, 0x2D, 0x00,
0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x43, 0x64,
0x81, 0x20, 0x43, 0x00, 0x50, 0x2D, 0x64, 0x81, 0x20, 0x2D,
0x00, 0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x43,
0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x2D, 0x64, 0x81, 0x20,
0x2D, 0x00, 0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50,
0x43, 0x64, 0x81, 0x20, 0x43, 0x00, 0x50, 0x41, 0x64, 0x81,
0x20, 0x41, 0x00, 0x50, 0x2E, 0x64, 0x81, 0x20, 0x2E, 0x00,
0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00, 0x50, 0x41, 0x64,
0x81, 0x20, 0x41, 0x00, 0x50, 0x2E, 0x64, 0x81, 0x20, 0x2E,
0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00, 0x50, 0x41,
0x64, 0x81, 0x20, 0x41, 0x00, 0x50, 0x2E, 0x64, 0x81, 0x20,
0x2E, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00, 0x50,
0x40, 0x64, 0x81, 0x20, 0x40, 0x00, 0x50, 0x2E, 0x64, 0x81,
0x20, 0x2E, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00,
0x50, 0x40, 0x64, 0x81, 0x20, 0x40, 0x00, 0x50, 0x2E, 0x64,
0x81, 0x20, 0x2E, 0x00, 0x50, 0x40, 0x64, 0x81, 0x20, 0x40,
0x00, 0x50, 0x41, 0x64, 0x81, 0x20, 0x41, 0x00, 0x50, 0x40,
0x64, 0x81, 0x20, 0x40, 0x00, 0x50, 0x2E, 0x64, 0x81, 0x20,
0x2E, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00, 0x50,
0x3E, 0x64, 0x81, 0x20, 0x3E, 0x00, 0x50, 0x2E, 0x64, 0x81,
0x20, 0x2E, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A, 0x00,
0x50, 0x3E, 0x64, 0x81, 0x20, 0x3E, 0x00, 0x50, 0x2E, 0x64,
0x81, 0x20, 0x2E, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20, 0x3A,
0x00, 0x50, 0x40, 0x64, 0x81, 0x20, 0x40, 0x00, 0x50, 0x2E,
0x64, 0x81, 0x20, 0x2E, 0x00, 0x50, 0x3A, 0x64, 0x81, 0x20,
0x3A, 0x00, 0x50, 0x40, 0x64, 0x81, 0x20, 0x40, 0x00, 0x50,
0x2E, 0x64, 0x81, 0x20, 0x2E, 0x00, 0x50, 0x3A, 0x64, 0x81,
0x20, 0x3A, 0x00, 0x50, 0x40, 0x64, 0x81, 0x20, 0x40, 0x00,
0x50, 0x41, 0x64, 0x81, 0x20, 0x41, 0x00, 0x50, 0x30, 0x64,
0x81, 0x20, 0x30, 0x00, 0x50, 0x37, 0x64, 0x81, 0x20, 0x37,
0x00, 0x50, 0x41, 0x64, 0x81, 0x20, 0x41, 0x00, 0x50, 0x30,
0x64, 0x81, 0x20, 0x30, 0x00, 0x50, 0x37, 0x64, 0x81, 0x20,
0x37, 0x00, 0x50, 0x41, 0x64, 0x81, 0x20, 0x41, 0x00, 0x50,
0x30, 0x64, 0x81, 0x20, 0x30, 0x00, 0x50, 0x37, 0x64, 0x81,
0x20, 0x37, 0x00, 0x50, 0x43, 0x64, 0x81, 0x20, 0x43, 0x00,
0x50, 0x30, 0x64, 0x81, 0x20, 0x30, 0x00, 0x50, 0x37, 0x64,
0x81, 0x20, 0x37, 0x00, 0x50, 0x43, 0x64, 0x81, 0x20, 0x43,
0x00, 0x50, 0x30, 0x64, 0x81, 0x20, 0x30, 0x00, 0x50, 0x37,
0x64, 0x81, 0x20, 0x37, 0x00, 0x50, 0x43, 0x64, 0x81, 0x20,
0x43, 0x00, 0x50, 0x45, 0x64, 0x81, 0x20, 0x45, 0x00, 0x50,
0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x39, 0x64, 0x81,
0x20, 0x39, 0x00, 0x50, 0x45, 0x64, 0x81, 0x20, 0x45, 0x00,
0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x39, 0x64,
0x81, 0x20, 0x39, 0x00, 0x50, 0x45, 0x64, 0x81, 0x20, 0x45,
0x00, 0x50, 0x30, 0x64, 0x81, 0x20, 0x30, 0x00, 0x50, 0x39,
0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x40, 0x64, 0x81, 0x20,
0x40, 0x00, 0x50, 0x30, 0x64, 0x81, 0x20, 0x30, 0x00, 0x50,
0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x40, 0x64, 0x81,
0x20, 0x40, 0x00, 0x50, 0x30, 0x64, 0x81, 0x20, 0x30, 0x00,
0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x40, 0x64,
0x81, 0x20, 0x40, 0x00, 0x50, 0x41, 0x64, 0x81, 0x20, 0x41,
0x00, 0x50, 0x2E, 0x64, 0x81, 0x20, 0x2E, 0x00, 0x50, 0x35,
0x64, 0x81, 0x20, 0x35, 0x00, 0x50, 0x3E, 0x64, 0x81, 0x20,
0x3E, 0x00, 0x50, 0x2E, 0x64, 0x81, 0x20, 0x2E, 0x00, 0x50,
0x35, 0x64, 0x81, 0x20, 0x35, 0x00, 0x50, 0x3E, 0x64, 0x81,
0x20, 0x3E, 0x00, 0x50, 0x2E, 0x64, 0x81, 0x20, 0x2E, 0x00,
0x50, 0x35, 0x64, 0x81, 0x20, 0x35, 0x00, 0x50, 0x3C, 0x64,
0x81, 0x20, 0x3C, 0x00, 0x50, 0x2D, 0x64, 0x81, 0x20, 0x2D,
0x00, 0x50, 0x35, 0x64, 0x81, 0x20, 0x35, 0x00, 0x50, 0x3C,
0x64, 0x81, 0x20, 0x3C, 0x00, 0x50, 0x2D, 0x64, 0x81, 0x20,
0x2D, 0x00, 0x50, 0x35, 0x64, 0x81, 0x20, 0x35, 0x00, 0x50,
0x3C, 0x64, 0x81, 0x20, 0x3C, 0x00, 0x50, 0x3E, 0x64, 0x81,
0x20, 0x3E, 0x00, 0x50, 0x2B, 0x64, 0x81, 0x20, 0x2B, 0x00,
0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x3A, 0x64,
0x81, 0x20, 0x3A, 0x00, 0x50, 0x2B, 0x64, 0x81, 0x20, 0x2B,
0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x3A,
0x64, 0x81, 0x20, 0x3A, 0x00, 0x50, 0x2B, 0x64, 0x81, 0x20,
0x2B, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50,
0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x29, 0x64, 0x81,
0x20, 0x29, 0x00, 0x50, 0x30, 0x64, 0x81, 0x20, 0x30, 0x00,
0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x29, 0x64,
0x81, 0x20, 0x29, 0x00, 0x50, 0x30, 0x64, 0x81, 0x20, 0x30,
0x00, 0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x3A,
0x64, 0x81, 0x20, 0x3A, 0x00, 0x50, 0x27, 0x64, 0x81, 0x20,
0x27, 0x00, 0x50, 0x33, 0x64, 0x81, 0x20, 0x33, 0x00, 0x50,
0x37, 0x64, 0x81, 0x20, 0x37, 0x00, 0x50, 0x27, 0x64, 0x81,
0x20, 0x27, 0x00, 0x50, 0x33, 0x64, 0x81, 0x20, 0x33, 0x00,
0x50, 0x37, 0x64, 0x81, 0x20, 0x37, 0x00, 0x50, 0x27, 0x64,
0x81, 0x20, 0x27, 0x00, 0x50, 0x33, 0x64, 0x81, 0x20, 0x33,
0x00, 0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50, 0x29,
0x64, 0x81, 0x20, 0x29, 0x00, 0x50, 0x35, 0x64, 0x81, 0x20,
0x35, 0x00, 0x50, 0x39, 0x64, 0x81, 0x20, 0x39, 0x00, 0x50,
0x29, 0x64, 0x81, 0x20, 0x29, 0x00, 0x50, 0x37, 0x64, 0x81,
0x20, 0x37, 0x00, 0x50, 0x35, 0x64, 0x81, 0x20, 0x35, 0x00,
0x50, 0x37, 0x64, 0x81, 0x20, 0x37, 0x00, 0x50, 0x2B, 0x64,
0x81, 0x20, 0x2B, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32,
0x00, 0x50, 0x37, 0x64, 0x81, 0x20, 0x37, 0x00, 0x50, 0x2B,
0x64, 0x81, 0x20, 0x2B, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20,
0x32, 0x00, 0x50, 0x37, 0x64, 0x81, 0x20, 0x37, 0x00, 0x50,
0x2B, 0x64, 0x81, 0x20, 0x2B, 0x00, 0x50, 0x32, 0x64, 0x81,
0x20, 0x32, 0x00, 0x50, 0x37, 0x64, 0x81, 0x20, 0x37, 0x00,
0x50, 0x2B, 0x64, 0x81, 0x20, 0x2B, 0x00, 0x50, 0x32, 0x64,
0x81, 0x20, 0x32, 0x00, 0x50, 0x37, 0x64, 0x81, 0x20, 0x37,
0x00, 0x50, 0x2B, 0x64, 0x81, 0x20, 0x2B, 0x00, 0x50, 0x32,
0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x37, 0x64, 0x81, 0x20,
0x37, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50,
0x2B, 0x64, 0x81, 0x20, 0x2B, 0x00, 0x50, 0x32, 0x64, 0x81,
0x20, 0x32, 0x00, 0x50, 0x37, 0x64, 0x81, 0x20, 0x37, 0x00,
0x50, 0x2B, 0x64, 0x81, 0x20, 0x2B, 0x00, 0x50, 0x32, 0x64,
0x81, 0x20, 0x32, 0x00, 0x50, 0x37, 0x64, 0x81, 0x20, 0x37,
0x00, 0x50, 0x2B, 0x64, 0x81, 0x20, 0x2B, 0x00, 0x50, 0x32,
0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x37, 0x64, 0x81, 0x20,
0x37, 0x00, 0x50, 0x2B, 0x64, 0x81, 0x20, 0x2B, 0x00, 0x50,
0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x37, 0x64, 0x81,
0x20, 0x37, 0x00, 0x50, 0x2B, 0x64, 0x81, 0x20, 0x2B, 0x00,
0x50, 0x32, 0x64, 0x81, 0x20, 0x32, 0x00, 0x50, 0x37, 0x64,
0x81, 0x20, 0x37, 0x00, 0x50, 0x32, 0x64, 0x81, 0x20, 0x32,
0x00};




//Macros for Configuration Fuse Registers:
//Invoke macros to set up  device configuration fuse registers.
//The fuses will select the oscillator source, power-up timers, watch-dog
//timers etc. The macros are defined within the device
//header files. The configuration fuse registers reside in Flash memory.


// Internal FRC Oscillator
_FOSCSEL(FNOSC_FRC);							// FRC Oscillator
_FOSC(FCKSM_CSECMD & OSCIOFNC_ON  & POSCMD_NONE); 
												// Clock Switching is enabled and Fail Safe Clock Monitor is disabled
												// OSC2 Pin Function: OSC2 is Clock Output
												// Primary Oscillator Mode: Disabled

_FWDT(FWDTEN_OFF);              				// Watchdog Timer Enabled/disabled by user software
												// (LPRC can be disabled by clearing SWDTEN bit in RCON register

/*=============================================================================
initDac() is used to configure D/A. 
=============================================================================*/
void initDac(void)
{
	/* Initiate DAC Clock */
	ACLKCONbits.SELACLK = 0;		// FRC w/ Pll as Clock Source 
	ACLKCONbits.AOSCMD = 0;			// Auxiliary Oscillator Disabled
	ACLKCONbits.ASRCSEL = 0;		// Auxiliary Oscillator is the Clock Source
	ACLKCONbits.APSTSCLR = 7;		// FRC divide by 1 

	DAC1STATbits.LOEN = 1;			// Left Channel DAC Output Enabled  
	DAC1STATbits.LITYPE = 1;        // interrupt when FIFO empty

	DAC1DFLT = 0x8000;				// DAC Default value is the midpoint 
	
				    	  // 103.16KHz  	// 8.038KHz		// 44.211KHz	// 25KHz
	DAC1CONbits.DACFDIV = 5; 		  		//76; 			//13; 		    // 23; //		// Divide High Speed Clock by DACFDIV+1 
	
	DAC1CONbits.FORM = 1;			// Data Format is signed integer
	DAC1CONbits.AMPON = 0;			// Analog Output Amplifier is enabled during Sleep Mode/Stop-in Idle mode

	DAC1CONbits.DACEN = 1;			// DAC1 Module Enabled 
}

void initDci(void)
{
	/* Initiate DAC Clock */
	ACLKCONbits.SELACLK = 0;		// FRC w/ Pll as Clock Source 
	ACLKCONbits.AOSCMD = 0;			// Auxiliary Oscillator Disabled
	ACLKCONbits.ASRCSEL = 0;		// Auxiliary Oscillator is the Clock Source
	ACLKCONbits.APSTSCLR = 7;		// FRC divide by 1 

	DAC1STATbits.LOEN = 1;			// Left Channel DAC Output Enabled  
	DAC1STATbits.LITYPE = 1;        // interrupt when FIFO empty

	DAC1DFLT = 0x8000;				// DAC Default value is the midpoint 
	
				    	  // 103.16KHz  	// 8.038KHz		// 44.211KHz	// 25KHz
	DAC1CONbits.DACFDIV = 5; 		  		//76; 			//13; 		    // 23; //		// Divide High Speed Clock by DACFDIV+1 
	
	DAC1CONbits.FORM = 1;			// Data Format is signed integer
	DAC1CONbits.AMPON = 0;			// Analog Output Amplifier is enabled during Sleep Mode/Stop-in Idle mode

	DAC1CONbits.DACEN = 1;			// DAC1 Module Enabled 
}

/*=============================================================================  
DMA0 configuration
 Direction: Read from peripheral address 0-x300 (ADC1BUF0) and write to DMA RAM 
 AMODE: Register indirect with post increment
 MODE: Continuous, Ping-Pong Mode
 IRQ: ADC Interrupt
 ADC stores results stored alternatively between BufferA[] and BufferB[]
=============================================================================*/
void initDma0(void) // Buffer -> DAC
{
	DMA0CONbits.AMODE = 0;			// Configure DMA for Register indirect with post increment
	DMA0CONbits.MODE = 2;			// Configure DMA for Continuous Ping-Pong mode
	DMA0CONbits.DIR = 1;			// RAM -> Peripheral

	DMA0PAD = (int)&DAC1LDAT;		// Peripheral Address Register: DAC FIFO
	DMA0CNT = (NUMSAMP-1);			// DMA Transfer Count is (NUMSAMP-1)	
	
	DMA0REQ = 0x4F;					// DAC1 Left Data Transfer interrupt selected for DMA channel IRQ
	
	DMA0STA = __builtin_dmaoffset(DacBufferA);	// DMA RAM Start Address A	
	DMA0STB = __builtin_dmaoffset(DacBufferB); // DMA RAM Start Address B

	//IFS0bits.DMA0IF = 0;			// Clear the DMA interrupt flag bit
    //IEC0bits.DMA0IE = 1;			// Set the DMA interrupt enable bit
	
	DMA0CONbits.CHEN = 1;			// Enable DMA channel
	//DMA0REQbits.FORCE = 1;  // Kick it off!
}


void initDma1(void) // Buffer -> DCI
{
	DMA1CONbits.AMODE = 0;			// Configure DMA for Register indirect with post increment
	DMA1CONbits.MODE = 2;			// Configure DMA for Continuous Ping-Pong mode
	DMA1CONbits.DIR = 1;			// RAM -> Peripheral

	DMA1PAD = (int)&TXBUF0;		// Peripheral Address Register: DAC FIFO
	DMA1CNT = (NUMSAMP-1);			// DMA Transfer Count is (NUMSAMP-1)	
	
	DMA1REQ = 0x3C;					// DCI Left Data Transfer interrupt selected for DMA channel IRQ
	
	DMA1STA = __builtin_dmaoffset(DciBufferA);	// DMA RAM Start Address A	
	DMA1STB = __builtin_dmaoffset(DciBufferB); // DMA RAM Start Address B

	//IFS0bits.DMA1IF = 0;			// Clear the DMA interrupt flag bit
    //IEC0bits.DMA1IE = 1;			// Set the DMA interrupt enable bit
	
	DMA1CONbits.CHEN = 1;			// Enable DMA channel
	//DMA1REQbits.FORCE = 1;  // Kick it off!
}


void initDma2(void) // DCI -> Buffer
{
	DMA2CONbits.AMODE = 0;			// Configure DMA for Register indirect with post increment
	DMA2CONbits.MODE = 2;			// Configure DMA for Continuous Ping-Pong mode
	DMA2CONbits.DIR = 0;			// Peripheral -> RAM

	DMA2PAD = (int)&RXBUF0;	        // Peripheral Address Register: DCI RX
	DMA2CNT = (NUMSAMP-1);			// DMA Transfer Count is (NUMSAMP-1)	

	DMA2REQ = 0x3C;					// DCI Data Transfer interrupt selected for DMA channel IRQ

	DMA2STA = __builtin_dmaoffset(DacBufferA);	// DMA RAM Start Address A	
	DMA2STB = __builtin_dmaoffset(DacBufferB); // DMA RAM Start Address B

	//IFS1bits.DMA2IF = 0;			// Clear the DMA interrupt flag bit
    //IEC1bits.DMA2IE = 1;			// Set the DMA interrupt enable bit
	
	DMA2CONbits.CHEN = 1;			// Enable DMA channel
	//DMA2REQbits.FORCE = 1;  // Kick it off!
}

void initDma7(void) // UART -> Buffer
{
	DMA7CONbits.AMODE = 0;			// Configure DMA for Register indirect with post increment
	DMA7CONbits.MODE = 2;			// Configure DMA for Continuous Ping-Pong mode
	DMA7CONbits.DIR = 0;			// Peripheral -> RAM
	DMA7CONbits.SIZE = 1;           // byte access

	DMA7PAD = (int)&U1RXREG;        // Peripheral Address Register: UART1 RX
	DMA7CNT = (MIDI_BUF_SIZE-1);			// DMA Transfer Count is (NUMSAMP-1)	

	DMA7REQ = 0x0B;					// DCI Data Transfer interrupt selected for DMA channel IRQ

	DMA7STA = __builtin_dmaoffset(MidiBufferA);	// DMA RAM Start Address A	
	DMA7STB = __builtin_dmaoffset(MidiBufferB); // DMA RAM Start Address B

	//IFS1bits.DMA2IF = 0;			// Clear the DMA interrupt flag bit
    //IEC1bits.DMA2IE = 1;			// Set the DMA interrupt enable bit
	
	DMA7CONbits.CHEN = 1;			// Enable DMA channel
	//DMA2REQbits.FORCE = 1;  // Kick it off!
}



/*=============================================================================
_DMA0Interrupt(): ISR name is chosen from the device linker script.
=============================================================================*/

void __attribute__((interrupt, no_auto_psv)) _DMA0Interrupt(void)
{
 	IFS0bits.DMA0IF = 0;			// Clear the DMA0 Interrupt Flag
}

void __attribute__((interrupt, no_auto_psv)) _DMA1Interrupt(void)
{
 	IFS0bits.DMA1IF = 0;			// Clear the DMA1 Interrupt Flag
}

void __attribute__((interrupt, no_auto_psv)) _DMA2Interrupt(void)
{
 	IFS1bits.DMA2IF = 0;			// Clear the DMA2 Interrupt Flag
}

void __attribute__((interrupt, no_auto_psv)) _DMA7Interrupt(void)
{
 	IFS4bits.DMA7IF = 0;			// Clear the DMA7 Interrupt Flag
}

/*=============================================================================
_DAC1LInterrupt(): ISR name is chosen from the device linker script.
=============================================================================*/
void __attribute__((interrupt, no_auto_psv)) _DAC1LInterrupt(void)
{
    IFS4bits.DAC1LIF = 0;     // Clear Left Channel Interrupt Flag
}

void __attribute__((interrupt, no_auto_psv)) _DCIInterrupt(void)
{
    IFS3bits.DCIIF = 0;       // Clear DCI Interrupt Flag 	 
}

unsigned long getLength()
{
    unsigned long l = 0;
    int count = 4;
    while (count--)
    {
        unsigned char z = d[didx++];
        l = l*128 + (z & 127);
        if ((z & 128) == 0)
            break;
    }

    return l;
}    

int getEvent()
{
    static unsigned char rstat = 0;
    unsigned char rx;

    rx = d[didx++];
    int msgbytes = 0;
    int len;

    // Meta Event, Sysex, Escaped SysEx, Channel Message
    if ( rx == 0xF0 ||  // SysEx
         rx == 0xF7 )   // escaped sysex
    {
        len = d[didx++];
        didx += len;
        rstat = 0;
        return 0;
    }
    else if ( rx == 0xFF ) // meta event
    {
        didx++; // skip type - don't care
        len = d[didx++];
        didx += len;
        rstat = 0;
        return 0;
    }
    else if ( rx >= 0x80 )
    {
        // get new running status
        rstat = rx;
        rx = d[didx++];
        msg[msgbytes++] = rstat;
    }
    else if ( rstat == 0 )
    {
        // bad - got data bytes without any running status active
        return 0;
    }    

    // 1 or 2 databytes of channel message left
    msg[msgbytes++] = rx;
    if ( !(rstat >= 0xC0 && rx <= 0xDF) )
    {
        // there's another byte to send
        rx = d[didx++];
        msg[msgbytes++] = rx;
    }

    return msgbytes;
}

int main (void)
{
	// Configure Oscillator to operate the device at 40MIPS
	// Fosc= Fin*M/(N1*N2), Fcy=Fosc/2
	// Fosc= 7.37M*43/(2*2)=79.22Mhz for ~40MIPS input clock
	PLLFBD=41;									// M=43
	CLKDIVbits.PLLPOST=0;						// N1=2
	CLKDIVbits.PLLPRE=0;						// N2=2
	OSCTUN=0;									// Tune FRC oscillator, if FRC is used

	// Disable Watch Dog Timer
	RCONbits.SWDTEN=0;

	// Clock switch to incorporate PLL
	__builtin_write_OSCCONH(0x01);				// Initiate Clock Switch to
												// FRC with PLL (NOSC=0b001)
	__builtin_write_OSCCONL(0x01);				// Start clock switching
	while (OSCCONbits.COSC != 0b001);			// Wait for Clock switch to occur

	// Wait for PLL to lock
	while(OSCCONbits.LOCK!=1);

	// Configure PPS: UART RX on RP5 (pin 14)
	__builtin_write_OSCCONL(OSCCON & ~(1<<6));
	RPINR18bits.U1RXR = 5;
	RPOR3bits.RP6R = 3;
	__builtin_write_OSCCONL(OSCCON | (1<<6));

	U1BRG  = 79;                    // 31250 @ 40MHz Fcy
	U1MODE = 0x8000; 				// Reset UART to 8-n-1, and enable 
	U1STA  = 0x0400; 				// Reset status register and enable TX & RX

	initDma0();									// Initialize the DMA controller to buffer ADC data in conversion order
	initDma7();									// Initialize the DMA controller to buffer UART RX data
	initDac(); 									// Initialize the D/A converter 

 	long i, j, k, l;
 	for (i=0; i<NUMSAMP; i++)
 	{
     	DacBufferA[i] = 0x7FFF;
     	DacBufferB[i] = 0x0000;
    }
    

    while (true)
    {    
        unsigned long len;
        didx = 0;
        while (didx < sizeof(d))
        { 			 
            len = getLength();
            for (i=0; i < len*750L; i++);
            len = getEvent();
            for (i = 0; i<len; i++)
            {
                while (U1STAbits.TRMT == 0);
                U1TXREG = msg[i];
            }    
    	}
    }	
    
	return 0;

}
